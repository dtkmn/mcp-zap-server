services:
  zap:
    image: zaproxy/zap-stable
    restart: always
    command:
      - zap.sh
      - -daemon
      - -host
      - 0.0.0.0
      - -port
      - "8090"
      - -config
      - api.disablekey=true
      - -config
      - api.addrs.addr.name=.*
      - -config
      - api.addrs.addr.regex=true
    ports:
      - "8090:8090"
    environment:
      ZAP_API_KEY: ""
    volumes:
      - ${LOCAL_ZAP_WORKPLACE_FOLDER}:/zap/wrk

  open-webui:
    image: ghcr.io/open-webui/open-webui
    ports:
      - "3000:8080"
    volumes:
      - open-webui:/app/backend/data

  mcpo:
    image: ghcr.io/open-webui/mcpo:main
    depends_on:
      - open-webui
      - mcp-server
    ports:
      - "8000:8000"
    command:
      - --port
      - "8000"
      - --server-type
      - "sse"
      - --
      - "http://mcp-server:7456/sse"

  mcpo-filesystem:
    image: ghcr.io/open-webui/mcpo:main
    depends_on:
      - open-webui
    ports:
      - "8001:8001"        # Expose the HTTP OpenAPI endpoint
    command:
      - --port
      - "8001"
      - --                  # End of mcpo flags; what follows is the MCP server command
      - "npx"
      - "-y"
      - "@modelcontextprotocol/server-filesystem"
      - "${LOCAL_ZAP_WORKPLACE_FOLDER}"         # Allowed directory inside the container
    volumes:
      - ${LOCAL_ZAP_WORKPLACE_FOLDER}:${LOCAL_ZAP_WORKPLACE_FOLDER}

  mcp-server:
    image: ghcr.io/dtkmn/mcp-zap-server:caeef1a
    restart: always
    depends_on:
      - zap
    ports:
      - "7456:7456"   # HTTP transport (SSE) endpoint
    environment:
      ZAP_API_URL: zap
      ZAP_API_PORT: 8090
    volumes:
      - ${LOCAL_ZAP_WORKPLACE_FOLDER}:/zap/wrk

volumes:
  open-webui: